### Order + Product Integration Tests

### Variables
@baseUrl = http://localhost:3000
@productId1 = 19c9b268-2084-47c2-b911-ddefcc2ffa4c
@productId2 = d4227ff0-22d5-4e7b-b15d-c7ca610c55e4
@orderId = {{create_order.response.body.id}}

### 1. Create Test Products First

# @name create_product_1  
POST {{baseUrl}}/products
Content-Type: application/json

{
  "name": "Mouse Logitech",
  "description": "Mouse sem fio",
  "price": 150.00,
  "stock": 10
}

###
# @name create_product_2
POST {{baseUrl}}/products
Content-Type: application/json

{
  "name": "Teclado Mecânico",
  "description": "Teclado RGB",
  "price": 350.00,
  "stock": 5
}

### 2. Check Products Stock Before Order
GET {{baseUrl}}/products

### 3. Create Order - Valid (1 item)
# @name create_order
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "João Silva",
  "items": [
    {
      "productId": "{{productId1}}",
      "quantity": 2
    }
  ]
}

### 4. Check Products Stock After Order (should be decremented)
GET {{baseUrl}}/products

### 5. Create Order - Valid (Multiple items)
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "Maria Santos",
  "items": [
    {
      "productId": "{{productId1}}",
      "quantity": 1
    },
    {
      "productId": "{{productId2}}",
      "quantity": 2
    }
  ]
}

### 6. Create Order - Product not found (should fail)
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "Pedro Costa",
  "items": [
    {
      "productId": "99999999-9999-9999-9999-999999999999",
      "quantity": 1
    }
  ]
}

### 7. Create Order - Insufficient stock (should fail)
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "Ana Lima", 
  "items": [
    {
      "productId": "{{productId2}}",
      "quantity": 100
    }
  ]
}

### 8. Create Order - Invalid data (should fail)
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "jose",
  "items": []
}

### 9. Create Order - Invalid quantity (should fail)
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "Carlos Oliveira",
  "items": [
    {
      "productId": "{{productId1}}",
      "quantity": 0
    }
  ]
}

### 10. Create Order - Inactive product 
# First deactivate a product
PATCH {{baseUrl}}/products/{{productId1}}
Content-Type: application/json

{
  "active": true
}

###
# Try to order inactive product (should fail)
POST {{baseUrl}}/orders
Content-Type: application/json

{
  "customerName": "Roberto Silva",
  "items": [
    {
      "productId": "{{productId1}}",
      "quantity": 1
    }
  ]
}

### 11. Check final stock state
GET {{baseUrl}}/products

### 12. Create more test data for complex scenarios
POST {{baseUrl}}/products
Content-Type: application/json

{
  "name": "Monitor 4K",
  "description": "Monitor 27 polegadas",
  "price": 1200.00,
  "stock": 3
}

### Expected Results:
# - Order creation should work for valid products with sufficient stock
# - Stock should be decremented after successful orders
# - Should fail for non-existent products
# - Should fail for insufficient stock
# - Should fail for inactive products
# - Should validate DTO constraints (quantity > 0, customerName required)